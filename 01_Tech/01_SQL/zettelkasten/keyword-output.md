`OUTPUT` ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ SQL Server, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç **–ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö** (`INSERT`, `UPDATE`, `DELETE`, `MERGE`) **–ø—Ä—è–º–æ –≤ –º–æ–º–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞**.

## üîπ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `OUTPUT`?

–ü–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü–æ–ª—É—á–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è **–≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö**, **—É–¥–∞–ª—ë–Ω–Ω—ã—Ö** –∏–ª–∏ **–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö** —Å—Ç—Ä–æ–∫    
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏—Ö —Å—Ä–∞–∑—É –≤ **—Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞** (`SELECT`)    
- –ò–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤–æ **–≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É**, **—Ç–∞–±–ª–∏—Ü—É-–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é**, **—Ä–µ–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É**

## üîë –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ "–ø—Å–µ–≤–¥–æ—Ç–∞–±–ª–∏—Ü—ã"

|–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ|–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç|
|---|---|
|`inserted`|–ù–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `INSERT` –∏ `UPDATE`)|
|`deleted`|–°—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `DELETE` –∏ `UPDATE`)|
### üìå –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- –ü—Ä–∏ **`INSERT`** ‚Äî –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ `inserted`    
- –ü—Ä–∏ **`DELETE`** ‚Äî —Ç–æ–ª—å–∫–æ `deleted`    
- –ü—Ä–∏ **`UPDATE`** ‚Äî –¥–æ—Å—Ç—É–ø–Ω—ã **–æ–±–µ**: `inserted` –∏ `deleted`    
- –ü—Ä–∏ **`MERGE`** ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `OUTPUT` –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å—Ä–∞–∑—É

## üõ† –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `OUTPUT`

###  1. ‚úÖ `INSERT ... OUTPUT` ‚Äî –≤–æ–∑–≤—Ä–∞—Ç ID –∏ –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:
```sql
INSERT INTO Products (Name, Price)
OUTPUT inserted.ProductID, inserted.Name
VALUES ('Tablet', 499.99);
```
‚û° –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID –∏ –∏–º—è –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞.

### 2. ‚úÖ `UPDATE ... OUTPUT` ‚Äî —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
```sql
UPDATE Products
SET Price = Price * 1.10
OUTPUT 
    deleted.Price AS OldPrice,
    inserted.Price AS NewPrice
WHERE Name = 'Monitor';
```
‚û° –ü–æ–ª—É—á–∏–º, –∫–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Ü–µ–Ω–∞.

###  3. ‚úÖ `DELETE ... OUTPUT` ‚Äî —É–¥–∞–ª—ë–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏:
```sql
DELETE FROM Products
OUTPUT deleted.ProductID, deleted.Name
WHERE Price < 10;
```
‚û° –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ **–∞—É–¥–∏—Ç —É–¥–∞–ª–µ–Ω–∏—è**.

###  4. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–∞–±–ª–∏—Ü—É:
```sql
DECLARE @DeletedProducts TABLE (
    ProductID INT,
    Name NVARCHAR(100)
);

DELETE FROM Products
OUTPUT deleted.ProductID, deleted.Name
INTO @DeletedProducts;
```

###  5. üîÑ –ü—Ä–∏–º–µ—Ä —Å UPDATE + JOIN + OUTPUT:
```sql
UPDATE p
SET p.Price = p.Price * 1.2
OUTPUT 
    deleted.ProductID,
    deleted.Price AS OldPrice,
    inserted.Price AS NewPrice
FROM Products p
JOIN Categories c ON p.CategoryID = c.CategoryID
WHERE c.Name = 'Electronics';
```







## üí° –ö–æ–≥–¥–∞ `OUTPUT` –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω:

- –í–æ–∑–≤—Ä–∞—Ç ID –ø—Ä–∏ –º–∞—Å—Å–æ–≤—ã—Ö –≤—Å—Ç–∞–≤–∫–∞—Ö    
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (`UPDATE`/`DELETE`) –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É    
- –ê—É–¥–∏—Ç: "—á—Ç–æ –±—ã–ª–æ" –∏ "—á—Ç–æ —Å—Ç–∞–ª–æ"    
- –û—Ç–ª–∞–¥–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö `MERGE`-–æ–ø–µ—Ä–∞—Ü–∏–π    

## ‚ö† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

|–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å|–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π|
|---|---|
|–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω `OUTPUT` –∑–∞ –∑–∞–ø—Ä–æ—Å|–ù–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å –¥–≤–∞ `OUTPUT` –ø–æ–¥—Ä—è–¥|
|–ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `OUTPUT` —Å `SELECT`|–¢–æ–ª—å–∫–æ —Å `INSERT/UPDATE/DELETE/MERGE`|
|`inserted` / `deleted` ‚Äî –Ω–µ –Ω–∞—Å—Ç–æ—è—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã|–≠—Ç–æ –ø—Å–µ–≤–¥–æ—Ç–∞–±–ª–∏—Ü—ã –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –∏–ª–∏ `OUTPUT`|

## Related topics:
- [[merge-audit]]
- [[identity-audit]]
- [[sql-joins]]