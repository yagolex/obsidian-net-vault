# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö/–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–í Microsoft SQL Server –µ—Å—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –ø–æ–ª—É—á–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏**, –∫–æ—Ç–æ—Ä—É—é —Ç—ã **—Ç–æ–ª—å–∫–æ —á—Ç–æ –≤—Å—Ç–∞–≤–∏–ª –∏–ª–∏ –æ–±–Ω–æ–≤–∏–ª**.
### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Å –ø–æ–º–æ—â—å—é SCOPE_IDENTITY:
```sql
INSERT INTO Users (Name) VALUES ('Alice');
SELECT SCOPE_IDENTITY();
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OUTPUT:
```sql
INSERT INTO Products (Name, Price)
OUTPUT inserted.ProductID
VALUES ('Phone', 399.99);
```
üìå –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è **–≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫** —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `INSERT`.
#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Å—Ç–∞—Ä—ã—Ö –∏ –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:
```sql
UPDATE Products
SET Price = Price * 1.10
OUTPUT deleted.Price AS OldPrice, inserted.Price AS NewPrice;
```

#### üîÅ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å `INSERT INTO ... OUTPUT INTO` (–±–µ–∑ SELECT):
```sql
DECLARE @NewIDs TABLE (ID INT);

INSERT INTO Orders (CustomerID, OrderDate)
OUTPUT inserted.OrderID INTO @NewIDs(ID)
VALUES (1, GETDATE());

SELECT * FROM @NewIDs;
```
üéØ –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Å—Ç–∞–≤–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏–ª–∏ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è.


### 3. **`@@IDENTITY`** ‚Äî –º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∞–Ω–∞–ª–æ–≥ `SCOPE_IDENTITY()`:
```sql
INSERT INTO Customers (Name) VALUES ('Test');
SELECT @@IDENTITY AS LastID;
```
‚ö†Ô∏è –û–ø–∞—Å–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å ID, –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π **–≤ —Ç—Ä–∏–≥–≥–µ—Ä–µ –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–∞–±–ª–∏—Ü–µ**.

### 4. **`IDENT_CURRENT('TableName')`** ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π `IDENTITY` –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ—Å—Å–∏–∏:
```sql
SELECT IDENT_CURRENT('Customers') AS LastCustomerID;
```
‚ö†Ô∏è  –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å **–∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –¥—Ä—É–≥–æ–π —Å–µ—Å—Å–∏–∏ –∏–ª–∏ –¥–∞–∂–µ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**, –ø–æ—ç—Ç–æ–º—É **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID "–≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –º–Ω–æ–π —Å—Ç—Ä–æ–∫–∏"**.



### ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ?

|–¶–µ–ª—å|–ò—Å–ø–æ–ª—å–∑—É–π|
|---|---|
|–ü–æ–ª—É—á–∏—Ç—å ID –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏|`SCOPE_IDENTITY()` –∏–ª–∏ `OUTPUT`|
|–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏|`OUTPUT inserted.*`|
|–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ä–æ–µ –∏ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ `UPDATE`|`OUTPUT deleted.*, inserted.*`|
|–ü–æ–ª—É—á–∏—Ç—å ID –∏–∑ —Ç—Ä–∏–≥–≥–µ—Ä–∞ (—Ä–∞–∑–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã)|`@@IDENTITY`|
|–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π ID –≥–ª–æ–±–∞–ª—å–Ω–æ|`IDENT_CURRENT('TableName')`|

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã:
- [[merge-audit]]
- [[execution-plan]]

## üîÅ –ü—Ä–∞–∫—Ç–∏–∫–∞ –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ
- [[returning-data_bloom]]
- [[returning-data_quiz]]
- [[keyword-output]]

#sql #zettelkasten