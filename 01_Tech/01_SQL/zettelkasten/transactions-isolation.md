# –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –∫–∞–∫ –µ–¥–∏–Ω–æ–≥–æ –±–ª–æ–∫–∞ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, –∏–∑–æ–ª—è—Ü–∏—é –∏ –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å (ACID).

## üß± –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (Transaction Isolation Levels):

**–ò–∑–æ–ª—è—Ü–∏—è** ‚Äî —ç—Ç–æ —Ç–æ, –∫–∞–∫ **–æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è "–≤–∏–¥–∏—Ç" –∏–∑–º–µ–Ω–µ–Ω–∏—è**, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–æ–π.

–ß–µ–º –≤—ã—à–µ –∏–∑–æ–ª—è—Ü–∏—è ‚Äî —Ç–µ–º **–º–µ–Ω—å—à–µ "–≥—Ä—è–∑–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö**, –Ω–æ **–±–æ–ª—å—à–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** –∏ **–Ω–∏–∂–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**.

| –£—Ä–æ–≤–µ–Ω—å          | –ì—Ä—è–∑–Ω—ã–µ —á—Ç–µ–Ω–∏—è | –ù–µ–ø–æ–≤—Ç–æ—Ä. —á—Ç–µ–Ω–∏—è | –§–∞–Ω—Ç–æ–º—ã |
| ---------------- | -------------- | ---------------- | ------- |
| READ UNCOMMITTED | ‚úÖ              | ‚úÖ                | ‚úÖ       |
| READ COMMITTED   | ‚ùå              | ‚úÖ                | ‚úÖ       |
| REPEATABLE READ  | ‚ùå              | ‚ùå                | ‚úÖ       |
| SERIALIZABLE     | ‚ùå              | ‚ùå                | ‚ùå       |
### **"–ê–Ω–æ–º–∞–ª–∏–∏ —á—Ç–µ–Ω–∏—è"**, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–Ω—è—Ç–∏–π:

#### üìå 1. –ì—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (Dirty Read)

> –ß—Ç–µ–Ω–∏–µ **–Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –∏–∑ –¥—Ä—É–≥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
##### üîç –ö–∞–∫ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:
1. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A** –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–æ **–µ—â—ë –Ω–µ –¥–µ–ª–∞–µ—Ç `COMMIT`**.    
2. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B** —á–∏—Ç–∞–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ.    
3. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A** –¥–µ–ª–∞–µ—Ç `ROLLBACK`.    
4. **B –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ "–≥—Ä—è–∑–Ω—ã–µ", –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ**.

#### üìå 2. –ù–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è —á—Ç–µ–Ω–∏–µ (Non-Repeatable Read)

> **–û–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É** –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏—Ö –∏–∑–º–µ–Ω–∏–ª–∞ –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∞.

##### üîç –ö–∞–∫ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:
1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A –¥–µ–ª–∞–µ—Ç `SELECT` ‚Äî —á–∏—Ç–∞–µ—Ç —Å—Ç—Ä–æ–∫—É.    
2. –í —ç—Ç–æ –≤—Ä–µ–º—è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B **–æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–ª–∏ —É–¥–∞–ª—è–µ—Ç** —ç—Ç—É —Å—Ç—Ä–æ–∫—É –∏ –¥–µ–ª–∞–µ—Ç `COMMIT`.    
3. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A —Å–Ω–æ–≤–∞ —á–∏—Ç–∞–µ—Ç —ç—Ç—É –∂–µ —Å—Ç—Ä–æ–∫—É ‚Äî **–∏ –ø–æ–ª—É—á–∞–µ—Ç –¥—Ä—É–≥–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**.

#### üìå 3. –§–∞–Ω—Ç–æ–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (Phantom Read)

> –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å **–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –Ω–∞–±–æ—Ä—ã —Å—Ç—Ä–æ–∫**, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ **–¥–æ–±–∞–≤–∏–ª–∏ –∏–ª–∏ —É–¥–∞–ª–∏–ª–∏ —Å—Ç—Ä–æ–∫–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —É—Å–ª–æ–≤–∏—é**.

##### üîç –ö–∞–∫ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:
1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A –¥–µ–ª–∞–µ—Ç `SELECT` —Å —Ñ–∏–ª—å—Ç—Ä–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Price > 100`)    
2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B –¥–æ–±–∞–≤–ª—è–µ—Ç **–Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É**, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ø–∞–¥–∞–µ—Ç –ø–æ–¥ —É—Å–ª–æ–≤–∏–µ, –∏ –¥–µ–ª–∞–µ—Ç `COMMIT`    
3. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A —Å–Ω–æ–≤–∞ –¥–µ–ª–∞–µ—Ç `SELECT` ‚Äî **–ø–æ–ª—É—á–∞–µ—Ç –¥—Ä—É–≥—É—é –≤—ã–±–æ—Ä–∫—É**


### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π:
```sql
BEGIN TRANSACTION;

UPDATE Accounts SET Balance = Balance - 100 WHERE AccountID = 1;
UPDATE Accounts SET Balance = Balance + 100 WHERE AccountID = 2;

IF @@ERROR <> 0
    ROLLBACK;
ELSE
    COMMIT;
```

üéØ –ü–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥ –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏: –æ–±–∞ `UPDATE` –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ ‚Äî –∏–Ω–∞—á–µ –≤—Å—ë –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è.
### –°–≤–æ–¥–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
#### üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞: –∫–∞–∫–∏–µ –∞–Ω–æ–º–∞–ª–∏–∏ –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö –∏–∑–æ–ª—è—Ü–∏–∏

|–£—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏|–ì—Ä—è–∑–Ω—ã–µ —á—Ç–µ–Ω–∏—è|–ù–µ–ø–æ–≤—Ç–æ—Ä. —á—Ç–µ–Ω–∏—è|–§–∞–Ω—Ç–æ–º—ã|
|---|---|---|---|
|READ UNCOMMITTED|‚úÖ –î–∞|‚úÖ –î–∞|‚úÖ –î–∞|
|READ COMMITTED|‚ùå –ù–µ—Ç|‚úÖ –î–∞|‚úÖ –î–∞|
|REPEATABLE READ|‚ùå –ù–µ—Ç|‚ùå –ù–µ—Ç|‚úÖ –î–∞|
|SERIALIZABLE|‚ùå –ù–µ—Ç|‚ùå –ù–µ—Ç|‚ùå –ù–µ—Ç|
|SNAPSHOT|‚ùå –ù–µ—Ç|‚ùå –ù–µ—Ç|‚ùå –ù–µ—Ç|
#### ‚úÖ –ö–∞–∫ –±–æ—Ä–æ—Ç—å—Å—è:

|–ê–Ω–æ–º–∞–ª–∏—è|–†–µ—à–µ–Ω–∏–µ|
|---|---|
|–ì—Ä—è–∑–Ω—ã–µ —á—Ç–µ–Ω–∏—è|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `READ COMMITTED` –∏ –≤—ã—à–µ|
|–ù–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è|`REPEATABLE READ`, `SERIALIZABLE`, `SNAPSHOT`|
|–§–∞–Ω—Ç–æ–º—ã|`SERIALIZABLE` –∏–ª–∏ `SNAPSHOT`|

#### ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ?

|–°—Ü–µ–Ω–∞—Ä–∏–π|–£—Ä–æ–≤–µ–Ω—å|
|---|---|
|–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ—Ç—á–µ—Ç—ã|`READ COMMITTED`, `SNAPSHOT`|
|–¢–æ—á–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ (–±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)|`REPEATABLE READ`, `SERIALIZABLE`|
|–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫|`SNAPSHOT`|
|–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ, –≥–¥–µ –æ—à–∏–±–∫–∏ –Ω–µ —Å—Ç—Ä–∞—à–Ω—ã|`READ UNCOMMITTED` (–æ—á–µ–Ω—å –∞–∫–∫—É—Ä–∞—Ç–Ω–æ!)|


## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã:
- [[merge-audit]]
- [[normalization]]
- [[read-write-db-split]]

## üîÅ –ü—Ä–∞–∫—Ç–∏–∫–∞ –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ
- [[transactions-isolation_bloom]]
- [[transactions-isolation_quiz]]

#sql #zettelkasten