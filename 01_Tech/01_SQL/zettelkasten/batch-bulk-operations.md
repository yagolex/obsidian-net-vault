# Batch –∏ Bulk –æ–ø–µ—Ä–∞—Ü–∏–∏

## Batch:
–ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–æ —á–∞—Å—Ç—è–º.
```sql
WHILE 1 = 1
BEGIN
  DELETE TOP (1000) FROM Logs WHERE Date < '2020-01-01';
  IF @@ROWCOUNT = 0 BREAK;
END
```
üìå –£–¥–∞–ª—è–µ—Ç –ø–æ 1000 —Å—Ç—Ä–æ–∫ –∑–∞ —Ä–∞–∑, –ø–æ–∫–∞ –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö.

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ batch-–æ–ø–µ—Ä–∞—Ü–∏—è–º

|–ß—Ç–æ –¥–µ–ª–∞—Ç—å|–ü–æ—á–µ–º—É|
|---|---|
|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TOP` –∏–ª–∏ `OFFSET`|–î–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–∫–µ—Ç–∞|
|–û–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –≤ `TRANSACTION`|–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∞—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ|
|–ü—Ä–æ–≤–µ—Ä—è—Ç—å `@@ROWCOUNT` –∏–ª–∏ `@@FETCH_STATUS`|–ß—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å, –∫–æ–≥–¥–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è|
|–°—Ç–∞–≤–∏—Ç—å –ø–∞—É–∑—ã (`WAITFOR DELAY`)|–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–µ—Ä–≤–µ—Ä|
|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SET NOCOUNT ON`|–ß—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å –≤—ã–≤–æ–¥ —Å–ª—É–∂–µ–±–Ω–æ–π –∏–Ω—Ñ–æ–π|
## Bulk:
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
```sql
BULK INSERT Products
FROM 'C:\data\products.csv'
WITH (FIELDTERMINATOR = ',', ROWTERMINATOR = '\n');
```
üìå –≠—Ç–æ –≤—Å—Ç–∞–≤–∏—Ç —Å—Ç—Ä–æ–∫–∏ –∏–∑ `products.csv` –≤ —Ç–∞–±–ª–∏—Ü—É `Products`.
### üîß –í–∞—Ä–∏–∞–Ω—Ç—ã BULK –æ–ø–µ—Ä–∞—Ü–∏–π –≤ **SQL Server**

|–û–ø–µ—Ä–∞—Ü–∏—è|–ß—Ç–æ –¥–µ–ª–∞–µ—Ç|
|---|---|
|`BULK INSERT`|–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ (`.csv`, `.txt`)|
|`INSERT ... FROM OPENROWSET(BULK...)`|–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ –∫–∞–∫ —Ç–∞–±–ª–∏—Ü—É|
|`bcp` (Bulk Copy Program)|–£—Ç–∏–ª–∏—Ç–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞/—ç–∫—Å–ø–æ—Ä—Ç–∞|
|`SqlBulkCopy` (–≤ C#)|API –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ .NET|
|`FORMATFILE`|–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —à–∞–±–ª–æ–Ω —Ä–∞–∑–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ|
### ‚ö†Ô∏è –í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å:

|–ß—Ç–æ —É—á–∏—Ç—ã–≤–∞—Ç—å|–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ|
|---|---|
|–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏, —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤|–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å—Ç—ã–º–∏|
|–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –æ—à–∏–±–æ–∫|–õ—É—á—à–µ —É–∫–∞–∑—ã–≤–∞—Ç—å `ERRORFILE`|
|–ú–æ–∂–µ—Ç –æ–±–æ–π—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (`CHECK`, `FK`)|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é|
|–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `ID INSERT SELECT`|–≠—Ç–æ —á–∏—Å—Ç—ã–π –∏–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞|
### ‚úÖ –°–æ–≤–µ—Ç—ã –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

- –ò—Å–ø–æ–ª—å–∑—É–π `TABLOCK` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤ –ø—É—Å—Ç—É—é —Ç–∞–±–ª–∏—Ü—É    
- –û—Ç–∫–ª—é—á–∏ `NONCLUSTERED` –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏    
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π —Å–Ω–∞—á–∞–ª–∞ –≤–æ **–≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É**, –ø–æ—Ç–æ–º –æ—á–∏—â–∞–π/–ø—Ä–æ–≤–µ—Ä—è–π/–ø–µ—Ä–µ–Ω–æ—Å–∏    
- –û—Ç–∫–ª—é—á–∏ **—Ç—Ä–∏–≥–≥–µ—Ä—ã**, **–∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç—ã** –∏ –ª–æ–≥–∏–∫—É, –µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã
- [[sql-joins]]
- [[join-vs-union]]
- [[group-by-aggregates]]
- [[subqueries]]
- [[merge-audit]]
- [[transactions-isolation]]
- [[normalization]]
- [[constraints-check-default]]
- [[cte-vs-temp-tables]]
- [[recursive-queries]]
- [[execution-plan]]
- [[query-optimization]]
- [[partitioned-indexed]]
- [[read-write-db-split]]
- [[sql-debug-testing]]

## üîÅ –ü—Ä–∞–∫—Ç–∏–∫–∞ –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ
- [[batch-bulk-operations_bloom]]
- [[batch-bulk-operations_quiz]]

#sql #zettelkasten