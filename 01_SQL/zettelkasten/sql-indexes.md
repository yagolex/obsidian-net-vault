# SQL Indexes 

## üìå –ß—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω–¥–µ–∫—Å?

–ò–Ω–¥–µ–∫—Å –≤ SQL ‚Äî —ç—Ç–æ **—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**, –∫–æ—Ç–æ—Ä–∞—è —É—Å–∫–æ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–æ–∫–∞–º —Ç–∞–±–ª–∏—Ü—ã, –∫–∞–∫ **–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∏** –∏–ª–∏ **—É–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É**.

–í–Ω—É—Ç—Ä–∏ ‚Äî —ç—Ç–æ **B-–¥–µ—Ä–µ–≤–æ**, –∫–æ—Ç–æ—Ä–æ–µ SQL Server (–∏–ª–∏ –¥—Ä—É–≥–æ–π –¥–≤–∏–∂–æ–∫) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –Ω—É–∂–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –±–µ–∑ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã.

## üéØ –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã?

‚úÖ –ü–æ–≤—ã—à–∞—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- `SELECT`, `WHERE`, `JOIN`, `ORDER BY`, `GROUP BY`  
    ‚úÖ –ü–æ–∑–≤–æ–ª—è—é—Ç **–∏–∑–±–µ–∂–∞—Ç—å Table Scan**  
    ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è **–ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏** (`PRIMARY KEY`, `UNIQUE`)
    

‚ùå –ù–æ:

- –ò–Ω–¥–µ–∫—Å—ã **–∑–∞–º–µ–¥–ª—è—é—Ç –≤—Å—Ç–∞–≤–∫—É/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ**, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å.
    
- –ò–Ω–¥–µ–∫—Å—ã **–∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ –≤ –±–∞–∑–µ**.

## üì¶ –í–∏–¥—ã –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ SQL Server (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤ PostgreSQL, MySQL)

### 1. üîπ **–ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å (Clustered Index)**

- **–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ**.
    
- –¢–æ–ª—å–∫–æ **–æ–¥–∏–Ω –Ω–∞ —Ç–∞–±–ª–∏—Ü—É**.
    
- –¢–∞–±–ª–∏—Ü–∞ –±–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **heap**.
#### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è:
```sql
CREATE CLUSTERED INDEX IX_Orders_OrderDate
ON Orders(OrderDate);
```
üß† –î–∞–Ω–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ `OrderDate`.

### 2. üî∏ **–ù–µ–∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å (Non-Clustered Index)**

- –•—Ä–∞–Ω–∏—Ç **–æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É**, —Å—Å—ã–ª–∞—é—â—É—é—Å—è –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ.
    
- –ú–æ–∂–µ—Ç –±—ã—Ç—å **–º–Ω–æ–≥–æ –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ**.
    
- –≠—Ç–æ –∫–∞–∫ —É–∫–∞–∑–∞—Ç–µ–ª—å —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
#### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è:
```sql
CREATE NONCLUSTERED INDEX IX_Orders_CustomerID
ON Orders(CustomerID);
```
üß† –£—Å–∫–æ—Ä–∏—Ç `WHERE CustomerID = ...`, –Ω–æ –Ω–µ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ —Å—Ç—Ä–æ–∫.

### üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –∏ –Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ

|–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞|–ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å|–ù–µ–∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å|
|---|---|---|
|**–ü–æ—Ä—è–¥–æ–∫ —Å—Ç—Ä–æ–∫**|–°–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–Ω–¥–µ–∫—Å–æ–º|–ù–µ –≤–ª–∏—è–µ—Ç|
|**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**|–¢–æ–ª—å–∫–æ 1 –Ω–∞ —Ç–∞–±–ª–∏—Ü—É|–ú–Ω–æ–≥–æ (–¥–æ 999 –≤ SQL Server)|
|**–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è**|–í —Å–∞–º–æ–π —Ç–∞–±–ª–∏—Ü–µ|–í –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, —Å—Å—ã–ª–∞—é—â–µ–π—Å—è –Ω–∞ —Å—Ç—Ä–æ–∫–∏|
|**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**|–ë—ã—Å—Ç—Ä–µ–µ –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ (`BETWEEN`)|–ë—ã—Å—Ç—Ä–µ–µ –¥–ª—è —Ç–æ—á–µ—á–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–∫ (`=`)|
|**–î–æ–ø. —á—Ç–µ–Ω–∏—è**|–ù–µ —Ç—Ä–µ–±—É–µ—Ç|–ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å `Key Lookup` (–¥–æ—Ä–æ–≥–æ)|


### 3. üîπ **–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å (UNIQUE INDEX)**

- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π –≤ –∫–æ–ª–æ–Ω–∫–µ**
    
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ `PRIMARY KEY` –∏ `UNIQUE CONSTRAINT`

#### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è:
```sql
CREATE UNIQUE INDEX IX_Email
ON Users(Email);
```

### 4. üîπ **–§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å (Filtered Index)**

- –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å —Å—Ç—Ä–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

#### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è:
```sql
CREATE NONCLUSTERED INDEX IX_ActiveUsers
ON Users(Status)
WHERE Status = 'Active';
```

üî• –û—á–µ–Ω—å –ø–æ–ª–µ–∑–µ–Ω –ø—Ä–∏ **–Ω–µ–±–æ–ª—å—à–æ–º –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö** –≤ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

### 5. üî∏ **–ò–Ω–¥–µ–∫—Å —Å INCLUDE –∫–æ–ª–æ–Ω–∫–∞–º–∏**

- –î–æ–±–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ –∏–Ω–¥–µ–∫—Å (–¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –∑–∞–ø—Ä–æ—Å–∞)
    
- –ò–∑–±–µ–≥–∞–µ—Ç `Key Lookup`

#### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è:
```sql
CREATE NONCLUSTERED INDEX IX_Orders_CustomerID
ON Orders(CustomerID)
INCLUDE(OrderDate, TotalAmount);
```

üß† –ò–¥–µ–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —Ç—ã –¥–µ–ª–∞–µ—à—å `SELECT OrderDate, TotalAmount FROM Orders WHERE CustomerID = ...`

### 6. üî∏ **XML, Spatial, Full-text –∏–Ω–¥–µ–∫—Å—ã** (—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

- **XML Index** ‚Äî –¥–ª—è XML –∫–æ–ª–æ–Ω–æ–∫
    
- **Full-text Index** ‚Äî –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
    
- **Spatial Index** ‚Äî –¥–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## üîç –ö–∞–∫ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π –∏–Ω–¥–µ–∫—Å –Ω—É–∂–µ–Ω?

1. –ü–æ—Å–º–æ—Ç—Ä–∏ **Execution Plan**:    
   - `Table Scan` ‚Üí –Ω—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å        
   - `Key Lookup` ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å `INCLUDE`
   
2. –ò—Å–ø–æ–ª—å–∑—É–π **SQL Server DTA (Database Tuning Advisor)** –∏–ª–∏:
   
```sql
SELECT * FROM sys.dm_db_missing_index_details;
```

3. –ù–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–π –≤—Å—ë –ø–æ–¥—Ä—è–¥ ‚Äî —ç—Ç–æ **–≤–ª–∏—è–µ—Ç –Ω–∞ INSERT/UPDATE/DELETE**.

## ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

|–°–æ–≤–µ—Ç—ã|
|---|
|–ò–Ω–¥–µ–∫—Å–∏—Ä—É–π –ø–æ–ª—è, —É—á–∞—Å—Ç–≤—É—é—â–∏–µ –≤ `WHERE`, `JOIN`, `ORDER BY`, `GROUP BY`|
|–ò—Å–ø–æ–ª—å–∑—É–π `INCLUDE`, –µ—Å–ª–∏ –≤ `SELECT` –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏|
|–£–¥–∞–ª—è–π –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–ª–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã|
|–û–±–Ω–æ–≤–ª—è–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ—Å–ª–µ –º–∞—Å—Å–æ–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (`UPDATE STATISTICS`)|
|–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –ø–æ–º–æ—â—å—é `SET STATISTICS IO`, `TIME`, `Execution Plan`|

## Related topics:
- [[execution-plan]]
- [[query-optimization]]
- [[constraints-check-default]]


#sql #zettelkasten
