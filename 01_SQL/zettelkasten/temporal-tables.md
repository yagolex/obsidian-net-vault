# üï∞ –ß—Ç–æ —Ç–∞–∫–æ–µ Temporal Tables (System-Versioned) 

**Temporal Table** = —Ç–∞–±–ª–∏—Ü–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–µ–¥–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
### –ó–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã (–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏):
- –ê—É–¥–∏—Ç –±–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤    
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
## üìå –°—Ç—Ä—É–∫—Ç—É—Ä–∞:

```sql
CREATE TABLE Employees (
    ID INT PRIMARY KEY,
    Name NVARCHAR(100),
    Department NVARCHAR(100),
    ValidFrom DATETIME2 GENERATED ALWAYS AS ROW START,
    ValidTo   DATETIME2 GENERATED ALWAYS AS ROW END,
    PERIOD FOR SYSTEM_TIME (ValidFrom, ValidTo)
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE = dbo.EmployeesHistory));
```

### –í —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –µ—Å—Ç—å **–¥–≤–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã**:
1. **–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞** ‚Äî `Employees`    
2. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞** ‚Äî `EmployeesHistory` (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è SQL Server –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
3. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `EmployeesHistory`, –Ω–æ SQL Server —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –µ—ë –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º.
	1.  `EmployeesHistory` ‚Äî **–Ω–µ–ª—å–∑—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑–º–µ–Ω—è—Ç—å** (`INSERT`, `UPDATE`, `DELETE` –∑–∞–ø—Ä–µ—â–µ–Ω—ã)   
	2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è** –ø—Ä–∏ `UPDATE`, `DELETE` –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ 
	3. –î–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è **—á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø—Ä–æ—Å–æ–≤**
	4.  –•—Ä–∞–Ω–∏—Ç—Å—è –≤ **—Ç–æ–π –∂–µ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**

–í —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–ª—è **ValidFrom / ValidTo**. –ò—Ö –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Ö–æ—Ç—è –∏ –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç, –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –∏—Ö —è–≤–Ω–æ, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –º–æ–≥ —Å–æ–∑–¥–∞—Ç—å –∏—Ö –Ω–µ—è–≤–Ω–æ (—Å –ø–æ–º–æ—â—å—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞):
### üìå –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è ValidFrom / ValidTo:

```sql
CREATE TABLE Employees (
    ID INT PRIMARY KEY,
    Name NVARCHAR(100),
    Department NVARCHAR(100)
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE = dbo.EmployeesHistory));
```

üß© –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ SQL Server —Å–æ–∑–¥–∞—ë—Ç —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –≤—Ä–æ–¥–µ:
- `SysStartTime`    
- `SysEndTime`    

–ù–æ –æ–Ω–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –µ—Å—Ç—å –∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è.

## üïµ –ó–∞–ø—Ä–æ—Å —Å –∏—Å—Ç–æ—Ä–∏–µ–π:
```sql
SELECT * FROM Employees FOR SYSTEM_TIME ALL WHERE ID = 1;
```

üí°–î–æ—Å—Ç—É–ø–Ω—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã:
- `FOR SYSTEM_TIME` 
	- `AS OF`
	- `FROM TO` 
	- `BETWEEN` 
	- `CONTAINED IN`
### üîç –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

| ID  | Name       | Department | ValidFrom           | ValidTo             |
| --- | ---------- | ---------- | ------------------- | ------------------- |
| 1   | John Smith | Sales      | 2020-01-01 10:00:00 | 2021-01-01 09:00:00 |
| 1   | John Smith | Marketing  | 2021-01-01 09:00:00 | 2023-06-01 14:00:00 |
| 1   | John Smith | IT         | 2023-06-01 14:00:00 | 9999-12-31 23:59:59 |
- –ü–µ—Ä–≤–∞—è –∏ –≤—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∏ ‚Äî –∏–∑ `EmployeesHistory`    
- –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –∏–∑ `Employees`

–¢–æ –µ—Å—Ç—å, –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å –∏—Å—Ç–æ—Ä–∏–µ–π SQL Server –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç:
- –¢–µ–∫—É—â—É—é –∑–∞–ø–∏—Å—å –∏–∑ `Employees`    
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `EmployeesHistory`

## üîé –ü—Ä–∏–º–µ—Ä—ã –¥—Ä—É–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
###  1. –í—Å–µ –≤–µ—Ä—Å–∏–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥::
```sql
SELECT * 
FROM Employees 
FOR SYSTEM_TIME 
FROM '2021-01-01' TO '2023-01-01' 
WHERE ID = 1;
```

###  2. –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏:
```sql
SELECT * 
FROM Employees 
FOR SYSTEM_TIME AS OF '2022-05-15T12:00:00'
WHERE ID = 1;
```

###  3. –¢–æ–ª—å–∫–æ —É–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏:
```sql
SELECT * 
FROM EmployeesHistory
EXCEPT
SELECT * 
FROM Employees;
```

### üîß –†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

|–°—Ü–µ–Ω–∞—Ä–∏–π|–ü—Ä–∏–º–µ—Ä|
|---|---|
|üßæ **–ê—É–¥–∏—Ç**|–ö—Ç–æ –∏–∑–º–µ–Ω–∏–ª –∑–∞—Ä–ø–ª–∞—Ç—É, –∫–æ–≥–¥–∞ –∏ –Ω–∞ —á—Ç–æ|
|‚è≥ **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**|–û—Ç—á—ë—Ç—ã –ø–æ –æ—Ç–¥–µ–ª–∞–º –≤ –ø—Ä–æ—à–ª–æ–º|
|üîÑ **–û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (rollback)**|–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ —É–¥–∞–ª–µ–Ω–∏—è|
|üß† **–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ—à–∏–±–æ–∫**|–ù–∞–π—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö|
|üìä **–í–µ—Ä—Å–∏–æ–Ω–Ω—ã–π BI/–∞–Ω–∞–ª–∏—Ç–∏–∫–∞**|–í—ã—á–∏—Å–ª–µ–Ω–∏–µ KPI —Å —É—á—ë—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏|

##  –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å: –∫–æ–ª–æ–Ω–∫–∏ —Ç–∏–ø–∞ `TEXT`, `IMAGE`, `FILESTREAM` ‚ùå **–Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** –≤ Temporal Tables

| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö      | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                         | –ü–æ—á–µ–º—É –∑–∞–ø—Ä–µ—â—ë–Ω –≤ Temporal Tables                                   |
| --------------- | ------------------------------------------------------------------ | ------------------------------------------------------------------- |
| `TEXT`, `NTEXT` | –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ç–∏–ø—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫                         | –£—Å—Ç–∞—Ä–µ–ª–∏, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã, –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `VARCHAR(MAX)` –∏ `NVARCHAR(MAX)` |
| `IMAGE`         | –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ –∏ —Ç.–¥.)                  | –ü–ª–æ—Ö–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –≤–µ—Ä—Å–∏–π                                   |
| `FILESTREAM`    | –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ **–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**, –Ω–æ —Å SQL-–¥–æ—Å—Ç—É–ø–æ–º | –•—Ä–∞–Ω–µ–Ω–∏–µ –≤–Ω–µ –æ–±—ã—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã, –Ω–µ –ø–æ–¥–¥–∞—ë—Ç—Å—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é          |
### ‚úÖ –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–≤–º–µ—Å—Ç–æ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤**:

|–ó–∞–ø—Ä–µ—â–µ–Ω–æ|–ò—Å–ø–æ–ª—å–∑—É–π –≤–º–µ—Å—Ç–æ|
|---|---|
|`TEXT`|`VARCHAR(MAX)`|
|`NTEXT`|`NVARCHAR(MAX)`|
|`IMAGE`|`VARBINARY(MAX)`|
|`FILESTREAM`|`VARBINARY(MAX)` (–≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã) –∏–ª–∏ External Storage (–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã –≤–µ—Ä—Å–∏–π)|
## Related topics:
- [[table-definition-and-behavior]]


#sql #zettelkasten
