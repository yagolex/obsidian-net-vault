# **–¢–∞–±–ª–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** –∏ **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫—É—Ä—Å–æ—Ä–æ–≤**

**—Ç–∞–±–ª–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**, –∏ **–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫—É—Ä—Å–æ—Ä–æ–≤**. –û–Ω–∏ ‚Äî –º–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ SQL –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ **–ø—Ä–æ—Ü–µ–¥—É—Ä** –∏ –∏–Ω–æ–≥–¥–∞ ‚Äî **—Ñ—É–Ω–∫—Ü–∏–π** (—Ç–∞–±–ª–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –Ω–µ –∫—É—Ä—Å–æ—Ä—ã).

## üìë –ß–∞—Å—Ç—å 1: –¢–∞–±–ª–∏—Ü—ã-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`@TableVar`):

–≠—Ç–æ –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—á–Ω–æ–≥–æ —Ç–∏–ø–∞ –∏–ª–∏ –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞, –Ω–æ –∂–∏–≤–µ—Ç **—Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞ –∫–æ–¥–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã).

üß† –ü–æ–ª–µ–∑–Ω–æ:
- –£–¥–æ–±–Ω–∞ –¥–ª—è **—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**, **–∞–≥—Ä–µ–≥–∞—Ü–∏–∏**, **—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏** –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.    
- –†–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (`#temp`) –ø—Ä–∏ –Ω–µ–±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö.
### üìå –ü—Ä–∏–º–µ—Ä: —Ç–∞–±–ª–∏—Ü–∞-–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
```sql
DECLARE @TopStudents TABLE (
    StudentID INT,
    Name NVARCHAR(100),
    CourseCount INT
);

INSERT INTO @TopStudents (StudentID, Name, CourseCount)
SELECT s.StudentID, s.Name, COUNT(e.CourseID)
FROM Students s
JOIN Enrollments e ON s.StudentID = e.StudentID
GROUP BY s.StudentID, s.Name
HAVING COUNT(e.CourseID) >= 2;

-- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–∞–±–ª–∏—Ü—É
SELECT * FROM @TopStudents;

```

## üìë –ß–∞—Å—Ç—å 2: –ö—É—Ä—Å–æ—Ä—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫—É—Ä—Å–æ—Ä–æ–≤:

–ö—É—Ä—Å–æ—Ä—ã –ø–æ–∑–≤–æ–ª—è—é—Ç **–ø–æ—à–∞–≥–æ–≤–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏**, –∫–∞–∫ —Ü–∏–∫–ª –≤ –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–º —è–∑—ã–∫–µ.

> ‚ö†Ô∏è –ö—É—Ä—Å–æ—Ä—ã —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞**, –∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –≤—ã—Ä–∞–∑–∏—Ç—å –ª–æ–≥–∏–∫—É —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–µ `SELECT`, `JOIN`, `UPDATE`..

### üìå –ü—Ä–∏–º–µ—Ä: –∫—É—Ä—Å–æ—Ä –ø–æ —Å–ø–∏—Å–∫—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:
```sql
DECLARE @StudentID INT;
DECLARE @Name NVARCHAR(100);

DECLARE student_cursor CURSOR FOR
SELECT StudentID, Name
FROM Students;

OPEN student_cursor;

FETCH NEXT FROM student_cursor INTO @StudentID, @Name;

WHILE @@FETCH_STATUS = 0
BEGIN
    PRINT 'Student: ' + @Name + ' (ID: ' + CAST(@StudentID AS NVARCHAR) + ')';

    -- –º–æ–∂–Ω–æ –∑–¥–µ—Å—å –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –≤—Å—Ç–∞–≤–∫–∏ –∏ —Ç.–¥.

    FETCH NEXT FROM student_cursor INTO @StudentID, @Name;
END;

CLOSE student_cursor;
DEALLOCATE student_cursor;

```

### üìå–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

| –ö–æ–º–∞–Ω–¥–∞          | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
| ---------------- | ------------------------------------------ |
| `DECLARE cursor` | –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞                         |
| `OPEN`           | –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫—É—Ä—Å–æ—Ä –¥–ª—è —á—Ç–µ–Ω–∏—è                |
| `FETCH NEXT`     | –ü–æ–ª—É—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É                  |
| `CLOSE`          | –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –∫—É—Ä—Å–æ—Ä                           |
| `DEALLOCATE`     | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å                         |
| `@@FETCH_STATUS` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ FETCH |


## üìë –ß–∞—Å—Ç—å 3: –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—Ç–∏–≤ –∫—É—Ä—Å–æ—Ä–∞: —á—Ç–æ –≤—ã–±—Ä–∞—Ç—å?

|–ó–∞–¥–∞—á–∞|–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç|
|---|---|
|–ú–∞—Å—Å–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö|‚úÖ –¢–∞–±–ª–∏—á–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è|
|–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ –∑–∞ —Å—Ç—Ä–æ–∫–æ–π (—Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞, –¥–∏–Ω–∞–º–∏–∫–∞)|‚úÖ –ö—É—Ä—Å–æ—Ä (—Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é)|
|–†–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö|‚ùå –ö—É—Ä—Å–æ—Ä—ã –º–æ–≥—É—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å|
|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ UDF-—Ñ—É–Ω–∫—Ü–∏—è—Ö|‚úÖ –¢–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ|


## Related topics:
- [[user-variables]]
- [[table-vars-vs-temp-tables]]


#sql #zettelkasten
